using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using CapaEntidades;
using CapaDatos;

public class ProductoDAL
{
    private string conexionString = "Server=.;Database=KEYSHA-KEVIN;Trusted_Connection=True;";

    // INSERTAR
    public void Insertar(Producto producto)
    {
        using (SqlConnection conn = new SqlConnection(conexionString))
        {
            SqlCommand cmd = new SqlCommand("sp_productos_insertar", conn);
            cmd.CommandType = CommandType.StoredProcedure;

            cmd.Parameters.AddWithValue("@nombre", producto.nombre_producto);
            cmd.Parameters.AddWithValue("@precio", producto.precio_producto);
            cmd.Parameters.AddWithValue("@stock", producto.stock);
            cmd.Parameters.AddWithValue("@id_categoria", producto.id_categoria);
            cmd.Parameters.AddWithValue("@estado", producto.estado);

            conn.Open();
            cmd.ExecuteNonQuery();
        }
    }

    // LISTAR
    public List<Producto> Listar()
    {
        List<Producto> lista = new List<Producto>();

        using (SqlConnection conn = new SqlConnection(conexionString))
        {
            SqlCommand cmd = new SqlCommand("sp_producto_listar", conn);
            cmd.CommandType = CommandType.StoredProcedure;

            conn.Open();
            SqlDataReader reader = cmd.ExecuteReader();

            while (reader.Read())
            {
                Producto p = new Producto()
                {
                    id_productos = Convert.ToInt32(reader["id_productos"]),
                    nombre_producto = reader["nombre_producto"].ToString(),
                    precio_producto = Convert.ToDecimal(reader["precio_producto"]),
                    stock = Convert.ToInt32(reader["stock"]),
                    id_categoria = Convert.ToInt32(reader["id_categoria"]),
                    estado = Convert.ToBoolean(reader["estado"])
                };

                lista.Add(p);
            }
        }

        return lista;
    }

    // ACTUALIZAR
    public void Actualizar(Producto producto)
    {
        using (SqlConnection conn = new SqlConnection(conexionString))
        {
            SqlCommand cmd = new SqlCommand("sp_productos_actualizar", conn);
            cmd.CommandType = CommandType.StoredProcedure;

            cmd.Parameters.AddWithValue("@id", producto.id_productos);
            cmd.Parameters.AddWithValue("@nombre", producto.nombre_producto);
            cmd.Parameters.AddWithValue("@precio", producto.precio_producto);
            cmd.Parameters.AddWithValue("@stock", producto.stock);
            cmd.Parameters.AddWithValue("@id_categoria", producto.id_categoria);
            cmd.Parameters.AddWithValue("@estado", producto.estado);

            conn.Open();
            cmd.ExecuteNonQuery();
        }
    }

    // ELIMINAR (lógico)
    public void Eliminar(int id)
    {
        using (SqlConnection conn = new SqlConnection(conexionString))
        {
            SqlCommand cmd = new SqlCommand("sp_productos_eliminar", conn);
            cmd.CommandType = CommandType.StoredProcedure;

            cmd.Parameters.AddWithValue("@id", id);

            conn.Open();
            cmd.ExecuteNonQuery();
        }
    }
}