using CapaDatos;
using CapaEntidades;
using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

public class CategoriaDAL
{
    // INSERTAR (como tu tabla tiene default 1, no es obligatorio mandar estado)
    public void Insertar(string nombre)
    {
        using (SqlConnection conn = new SqlConnection(ConexionString))
        {
            SqlCommand cmd = new SqlCommand("sp_categoria_insertar", conn);
            cmd.CommandType = CommandType.StoredProcedure;

            cmd.Parameters.AddWithValue("@nombre", nombre);
            cmd.Parameters.AddWithValue("@estado", true); // o lo puedes quitar si modificas el SP

            conn.Open();
            cmd.ExecuteNonQuery();
        }
    }

    // LISTAR
    public List<categoria> Listar()
    {
        List<categoria> lista = new List<categoria>();

        using (SqlConnection conn = new SqlConnection(conexionString))
        {
            SqlCommand cmd = new SqlCommand("sp_categoria_listar", conn);
            cmd.CommandType = CommandType.StoredProcedure;

            conn.Open();
            SqlDataReader reader = cmd.ExecuteReader();

            while (reader.Read())
            {
                categoria cat = new categoria()
                {
                    id_categoria = Convert.ToInt32(reader["id_categoria"]),
                    nombre_categoria = reader["nombre_categoria"].ToString(),
                    estado = Convert.ToBoolean(reader["estado"])
                };

                lista.Add(cat);
            }
        }

        return lista;
    }

    // ACTUALIZAR
    public void Actualizar(int id, string nombre, bool estado)
    {
        using (SqlConnection conn = new SqlConnection(conexionString))
        {
            SqlCommand cmd = new SqlCommand("sp_categoria_actualizar", conn);
            cmd.CommandType = CommandType.StoredProcedure;

            cmd.Parameters.AddWithValue("@id", id);
            cmd.Parameters.AddWithValue("@nombre", nombre);
            cmd.Parameters.AddWithValue("@estado", estado);

            conn.Open();
            cmd.ExecuteNonQuery();
        }
    }

    // DESACTIVAR
    public void Desactivar(int id)
    {
        using (SqlConnection conn = new SqlConnection(conexionString))
        {
            SqlCommand cmd = new SqlCommand("sp_categoria_desactivar", conn);
            cmd.CommandType = CommandType.StoredProcedure;

            cmd.Parameters.AddWithValue("@id", id);

            conn.Open();
            cmd.ExecuteNonQuery();
        }
    }
}